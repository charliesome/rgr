#!/usr/bin/env ruby
require "rgr"

if ARGV.empty?
  abort "Usage: rgr [<options>] <search_query> <files...>"
end

reporter = Rgr.reporter.new
ignore_prefixes = []

loop do
  case option = ARGV.shift
  when "--ignore"
    prefix = ARGV.shift or abort "Expected path after --ignore"
    ignore_prefixes << prefix
  else
    # not an option, put it back
    ARGV.unshift(option)
    break
  end
end

search_query = ARGV.shift
globber      = Rgr::Globber.new paths: ARGV, ignore_prefixes: ignore_prefixes

Rgr.search(search_query, globber.each_file).each do |file, matches|
  reporter.report_file_matches(file, matches)
end
